server_tokens off;
autoindex off;
proxy_hide_header X-Powered-By;
fastcgi_hide_header X-Powered-By;

# --- Gzip 压缩策略 ---
gzip on;
gzip_static on;
gzip_comp_level 5;
gzip_min_length 1k;
gzip_proxied any;
gzip_vary on;
gzip_types
  text/plain
  text/css
  application/javascript
  application/json
  application/x-javascript
  text/xml
  application/xml
  application/xml+rss
  text/javascript
  image/svg+xml;

# --- JSON 日志格式 ---
log_format json_format escape=json
  '{'
  '"time": "$time_iso8601",'
  '"remote_addr": "$remote_addr",'
  '"status": "$status",'
  '"request_time": "$request_time",'
  '"upstream_time": "$upstream_response_time",'
  '"body_bytes": "$body_bytes_sent",'
  '"request": "$request",'
  '"referer": "$http_referer",'
  '"ua": "$http_user_agent",'
  '"x_forwarded": "$http_x_forwarded_for"'
  '}';

# --- 后端上游配置 ---
upstream anubis {
  server unix:///run/socket/anubis.sock;
  # server 127.0.0.1:8923;
  keepalive 32;
}

# --- 协议升级映射 (用于 WebSocket) ---
map $http_upgrade $connection_upgrade {
  default upgrade;
  ''      close;
}
